<!DOCTYPE html>
<html lang="en" x-data="appData()" :data-theme="theme">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>India's Economic Paradox: Growth Without Accountability (2004-2025)</title>
  <meta name="description" content="Evidence-based analysis of India's economic transformation from 2004-2025. Academic research on growth, inequality, and democratic institutions.">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <style>
    :root { --bg-primary:#fff; --bg-secondary:#f9fafb; --bg-card:#fff; --text-primary:#111827; --text-secondary:#4b5563; --text-muted:#9ca3af; --border-color:#e5e7eb; --shadow-color:rgba(0,0,0,.1); --accent-purple:#7C3AED; --chart-bg:#fff; --nav-bg:#fff; }
    [data-theme="dark"]{ --bg-primary:#0f172a; --bg-secondary:#1e293b; --bg-card:#334155; --text-primary:#f1f5f9; --text-secondary:#cbd5e1; --text-muted:#94a3b8; --border-color:#475569; --shadow-color:rgba(0,0,0,.5); --chart-bg:#1e293b; --nav-bg:#1e293b; }
    body{ background:var(--bg-secondary); color:var(--text-primary); transition:.3s ease }
    .dark-card{ background:var(--bg-card); color:var(--text-primary) }
    .dark-nav{ background:var(--nav-bg) }
    .dark-text-primary{ color:var(--text-primary) } .dark-text-secondary{ color:var(--text-secondary) }
    .dark-border{ border-color:var(--border-color) }
    .chart-container{ position:relative; height:350px; width:100%; background:var(--chart-bg); padding:12px; border-radius:8px }
    .chart-container-small{ position:relative; height:250px; width:100%; background:var(--chart-bg); padding:12px; border-radius:8px }
    [x-cloak]{ display:none!important }
    .tab-active{ border-bottom:3px solid var(--accent-purple); color:var(--accent-purple) }
    .audience-active{ background:var(--accent-purple)!important; color:#fff!important; border-color:var(--accent-purple)!important }
    .export-buttons{ position:absolute; top:8px; right:8px; display:flex; gap:6px; opacity:.25; transition:.2s }
    .chart-wrapper:hover .export-buttons{ opacity:1 }
    @media print{ .no-print{ display:none!important } body{ background:#fff!important; color:#000!important } }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Theme toggle -->
  <button @click="toggleTheme()" class="fixed bottom-4 right-4 z-50 rounded-full w-11 h-11 flex items-center justify-center bg-purple-600 text-white shadow no-print" :title="theme==='light'?'Dark mode':'Light mode'">
    <svg x-show="theme==='light'" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/></svg>
    <svg x-show="theme==='dark'" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v2m0 14v2m7-9h2M3 12H1m15.364 6.364l1.414 1.414M4.222 4.222L5.636 5.636m12.728 0l1.414-1.414M4.222 19.778l1.414-1.414"/></svg>
  </button>

  <!-- Top -->
  <div class="dark-nav shadow sticky top-0 z-40 no-print">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-start mb-2">
        <div>
          <h1 class="text-2xl font-bold dark-text-primary">India's Two Decades: A Tale of Two Models</h1>
          <p class="text-xs dark-text-secondary">Comparing UPA (2004â€“2014) vs NDA (2014â€“2025)</p>
        </div>
        <div class="flex items-center gap-2">
          <label class="text-sm dark-text-secondary font-medium">I am a:</label>
          <div class="flex gap-2">
            <button @click="setAudience('academic')" :class="audienceType==='academic'?'audience-active':'dark-card dark-border'" class="px-3 py-1 text-xs rounded border">Researcher</button>
            <button @click="setAudience('policy')" :class="audienceType==='policy'?'audience-active':'dark-card dark-border'" class="px-3 py-1 text-xs rounded border">Policy Maker</button>
            <button @click="setAudience('journalist')" :class="audienceType==='journalist'?'audience-active':'dark-card dark-border'" class="px-3 py-1 text-xs rounded border">Journalist</button>
            <button @click="setAudience('general')" :class="audienceType==='general'?'audience-active':'dark-card dark-border'" class="px-3 py-1 text-xs rounded border">Citizen</button>
          </div>
        </div>
      </div>
      <div class="flex space-x-6 border-t dark-border pt-3 overflow-x-auto">
        <button @click="activeTab='about'" :class="activeTab==='about'?'tab-active':''" class="pb-2 px-1 text-sm font-medium dark-text-secondary whitespace-nowrap">What is This?</button>
        <button @click="activeTab='summary'" :class="activeTab==='summary'?'tab-active':''" class="pb-2 px-1 text-sm font-medium dark-text-secondary whitespace-nowrap">Executive Summary</button>
        <button @click="activeTab='findings'" :class="activeTab==='findings'?'tab-active':''" class="pb-2 px-1 text-sm font-medium dark-text-secondary whitespace-nowrap">Key Findings</button>
        <button @click="activeTab='data'" :class="activeTab==='data'?'tab-active':''" class="pb-2 px-1 text-sm font-medium dark-text-secondary whitespace-nowrap">Interactive Data</button>
        <button @click="activeTab='indices'" :class="activeTab==='indices'?'tab-active':''" class="pb-2 px-1 text-sm font-medium dark-text-secondary whitespace-nowrap">Three Indices</button>
        <button @click="activeTab='methods'" :class="activeTab==='methods'?'tab-active':''" class="pb-2 px-1 text-sm font-medium dark-text-secondary whitespace-nowrap">Methodology</button>
        <button @click="activeTab='implications'" :class="activeTab==='implications'?'tab-active':''" class="pb-2 px-1 text-sm font-medium dark-text-secondary whitespace-nowrap">Implications</button>
        <button @click="activeTab='whatnext'" :class="activeTab==='whatnext'?'tab-active':''" class="pb-2 px-1 text-sm font-medium dark-text-secondary whitespace-nowrap">What Next?</button>
      </div>
    </div>
  </div>

  <main class="container mx-auto px-4 py-8 flex-grow">
    <!-- Audience note -->
    <div x-show="audienceType" x-cloak class="mb-6">
      <div class="bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-600 p-4 rounded dark-card">
        <div class="grid md:grid-cols-5 gap-4 items-start">
          <p class="text-sm dark-text-primary md:col-span-3" x-html="getAudienceMessage()"></p>
          <div class="md:col-span-2">
            <div class="text-xs font-semibold mb-2 dark-text-primary">Notes for you</div>
            <ul class="text-xs dark-text-secondary space-y-1" x-html="getAudienceNotes()"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- SUMMARY -->
    <div x-show="activeTab==='summary'" x-cloak>
      <section class="dark-card rounded-lg shadow-lg p-6 mb-6">
        <h2 class="text-2xl font-bold mb-3 dark-text-primary">The Core Finding</h2>
        <div x-html="getSummaryContent()" class="prose max-w-none dark-text-secondary"></div>
        <div class="chart-wrapper relative mt-6">
          <div class="export-buttons">
            <button onclick="exportChart('summaryChart','png')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">PNG</button>
            <button onclick="exportChart('summaryChart','csv')" class="bg-green-500 text-white px-2 py-1 rounded text-xs">CSV</button>
          </div>
          <div class="chart-container"><canvas id="summaryChart"></canvas></div>
        </div>
        <p class="text-xs mt-2 dark-text-secondary">Note: Lower rank is better in Press Freedom. Shaded UPA/NDA bands appear in the Interactive Data tab.</p>
      </section>
    </div>

    <!-- FINDINGS -->
    <div x-show="activeTab==='findings'" x-cloak>
      <section class="space-y-8">
        <div class="dark-card rounded-lg shadow-lg p-6">
          <h3 class="text-xl font-bold mb-3 dark-text-primary">Finding 1: Jobs Transformed, Not Created</h3>
          <div class="grid md:grid-cols-2 gap-6">
            <div x-html="getEmploymentFindings()"></div>
            <div class="chart-wrapper relative">
              <div class="export-buttons">
                <button onclick="exportChart('employmentChart','png')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">PNG</button>
                <button onclick="exportChart('employmentChart','csv')" class="bg-green-500 text-white px-2 py-1 rounded text-xs">CSV</button>
              </div>
              <div class="chart-container-small"><canvas id="employmentChart"></canvas></div>
            </div>
          </div>
        </div>
        <div class="dark-card rounded-lg shadow-lg p-6">
          <h3 class="text-xl font-bold mb-3 dark-text-primary">Finding 2: Inequality Exceeds Colonial-Era Levels</h3>
          <div class="grid md:grid-cols-2 gap-6">
            <div class="chart-wrapper relative">
              <div class="export-buttons">
                <button onclick="exportChart('inequalityChart','png')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">PNG</button>
                <button onclick="exportChart('inequalityChart','csv')" class="bg-green-500 text-white px-2 py-1 rounded text-xs">CSV</button>
              </div>
              <div class="chart-container-small"><canvas id="inequalityChart"></canvas></div>
            </div>
            <div x-html="getInequalityFindings()"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- INTERACTIVE DATA -->
    <div x-show="activeTab==='data'" x-cloak>
      <section class="dark-card rounded-lg shadow-lg p-6 mb-6">
        <h2 class="text-2xl font-bold mb-4 dark-text-primary">Interactive Data Explorer</h2>
        <div class="grid md:grid-cols-5 gap-4">
          <div>
            <label class="text-xs dark-text-secondary">Primary Indicator</label>
            <select class="w-full p-2 border rounded dark-border" x-model="dataCfg.metric" @change="renderDataExplorer()">
              <option value="gdp">GDP Growth %</option>
              <option value="top1">Top 1% Income Share %</option>
              <option value="formal">Formal Employment %</option>
              <option value="informal">Informal/Gig %</option>
              <option value="press">Press Freedom Rank (lower is better)</option>
            </select>
          </div>
          <div>
            <label class="text-xs dark-text-secondary">Compare with</label>
            <select class="w-full p-2 border rounded dark-border" x-model="dataCfg.compare1" @change="renderDataExplorer()">
              <option value="">None</option>
              <option value="gdp">GDP Growth %</option>
              <option value="top1">Top 1% Income Share %</option>
              <option value="formal">Formal Employment %</option>
              <option value="informal">Informal/Gig %</option>
              <option value="press">Press Freedom Rank</option>
            </select>
          </div>
          <div>
            <label class="text-xs dark-text-secondary">+ Add another</label>
            <select class="w-full p-2 border rounded dark-border" x-model="dataCfg.compare2" @change="renderDataExplorer()">
              <option value="">None</option>
              <option value="gdp">GDP Growth %</option>
              <option value="top1">Top 1% Income Share %</option>
              <option value="formal">Formal Employment %</option>
              <option value="informal">Informal/Gig %</option>
              <option value="press">Press Freedom Rank</option>
            </select>
          </div>
          <div>
            <label class="text-xs dark-text-secondary">Chart Type</label>
            <select class="w-full p-2 border rounded dark-border" x-model="dataCfg.type" @change="renderDataExplorer()">
              <option value="line">Line</option>
              <option value="bar">Bar</option>
              <option value="area">Area</option>
            </select>
          </div>
          <div>
            <label class="text-xs dark-text-secondary">Year Range</label>
            <div class="flex items-center gap-2">
              <input type="number" class="w-20 p-2 border rounded dark-border" x-model.number="dataCfg.start" @change="renderDataExplorer()">
              <span class="text-xs dark-text-secondary">to</span>
              <input type="number" class="w-20 p-2 border rounded dark-border" x-model.number="dataCfg.end" @change="renderDataExplorer()">
            </div>
            <label class="inline-flex items-center gap-2 mt-2">
              <input type="checkbox" class="rounded" x-model="dataCfg.showRegimes" @change="renderDataExplorer()">
              <span class="text-xs dark-text-secondary">Show UPA/NDA shading</span>
            </label>
          </div>
        </div>

        <div class="chart-wrapper relative mt-4">
          <div class="export-buttons">
            <button @click="exportDataExplorer('png')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">PNG</button>
            <button @click="exportDataExplorer('csv')" class="bg-green-500 text-white px-2 py-1 rounded text-xs">CSV</button>
          </div>
          <div class="chart-container"><canvas id="dataExplorerChart"></canvas></div>
        </div>
      </section>

      <section class="dark-card rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-semibold mb-2 dark-text-primary">Visible Data (reflects current selection)</h3>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="text-left">
                <th class="px-3 py-2 border-b dark-border">Year</th>
                <th class="px-3 py-2 border-b dark-border" x-text="metricLabel(dataCfg.metric)"></th>
                <th class="px-3 py-2 border-b dark-border" x-text="dataCfg.compare1?metricLabel(dataCfg.compare1):''"></th>
                <th class="px-3 py-2 border-b dark-border" x-text="dataCfg.compare2?metricLabel(dataCfg.compare2):''"></th>
              </tr>
            </thead>
            <tbody>
              <template x-for="row in visibleDataRows" :key="row.year">
                <tr>
                  <td class="px-3 py-2 border-b dark-border" x-text="row.year"></td>
                  <td class="px-3 py-2 border-b dark-border" x-text="row.v1"></td>
                  <td class="px-3 py-2 border-b dark-border" x-text="row.v2 ?? ''"></td>
                  <td class="px-3 py-2 border-b dark-border" x-text="row.v3 ?? ''"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </section>
    </div>

    <!-- INDICES -->
    <div x-show="activeTab==='indices'" x-cloak>
      <section class="dark-card rounded-lg shadow-lg p-6">
        <h2 class="text-2xl font-bold mb-2 dark-text-primary">Three Indices</h2>
        <div class="grid md:grid-cols-3 gap-6">
          <div class="dark-card rounded border dark-border p-4">
            <h4 class="font-semibold mb-2">Statistical Suppression Index (SSI)</h4>
            <div class="chart-wrapper relative">
              <div class="export-buttons">
                <button onclick="exportChart('ssiChart','png')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">PNG</button>
                <button onclick="exportChart('ssiChart','csv')" class="bg-green-500 text-white px-2 py-1 rounded text-xs">CSV</button>
              </div>
              <div class="chart-container-small"><canvas id="ssiChart"></canvas></div>
            </div>
            <p class="text-xs mt-2 dark-text-secondary">Higher = more suppression (scaled 0â€“10).</p>
          </div>
          <div class="dark-card rounded border dark-border p-4">
            <h4 class="font-semibold mb-2">Fiscal Centralisation Index (FCI)</h4>
            <div class="chart-wrapper relative">
              <div class="export-buttons">
                <button onclick="exportChart('fciChart','png')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">PNG</button>
                <button onclick="exportChart('fciChart','csv')" class="bg-green-500 text-white px-2 py-1 rounded text-xs">CSV</button>
              </div>
              <div class="chart-container-small"><canvas id="fciChart"></canvas></div>
            </div>
            <p class="text-xs mt-2 dark-text-secondary">Share of centralised revenues/controls (0â€“1).</p>
          </div>
          <div class="dark-card rounded border dark-border p-4">
            <h4 class="font-semibold mb-2">Democratic Quality Index (DQI)</h4>
            <div class="chart-wrapper relative">
              <div class="export-buttons">
                <button onclick="exportChart('dqiChart','png')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs">PNG</button>
                <button onclick="exportChart('dqiChart','csv')" class="bg-green-500 text-white px-2 py-1 rounded text-xs">CSV</button>
              </div>
              <div class="chart-container-small"><canvas id="dqiChart"></canvas></div>
            </div>
            <p class="text-xs mt-2 dark-text-secondary">Higher is better (0â€“1).</p>
          </div>
        </div>
      </section>
    </div>

    <!-- METHODS -->
    <div x-show="activeTab==='methods'" x-cloak>
      <section class="dark-card rounded-lg shadow-lg p-6">
        <h2 class="text-2xl font-bold mb-2 dark-text-primary">Methodology (Brief)</h2>
        <div class="grid md:grid-cols-3 gap-6 text-sm dark-text-secondary">
          <div><h4 class="font-semibold mb-2 dark-text-primary">Data</h4><ul class="space-y-1"><li>â€¢ National Accounts; ASI</li><li>â€¢ PLFS/CMIE</li><li>â€¢ Tax (cess/surcharge)</li><li>â€¢ RBI BoP/FDI</li><li>â€¢ Press freedom & governance</li></ul></div>
          <div><h4 class="font-semibold mb-2 dark-text-primary">Estimands</h4><ul class="space-y-1"><li>â€¢ Employment elasticity</li><li>â€¢ Top 1% share</li><li>â€¢ Fiscal centralisation</li><li>â€¢ SSI, FCI, DQI</li></ul></div>
          <div><h4 class="font-semibold mb-2 dark-text-primary">Robustness</h4><ul class="space-y-1"><li>â€¢ Base-year sensitivity</li><li>â€¢ Alt. weights/components</li><li>â€¢ Pre-trend checks</li><li>â€¢ External validation</li></ul></div>
        </div>
      </section>
    </div>

    <!-- IMPLICATIONS -->
    <div x-show="activeTab==='implications'" x-cloak>
      <section class="dark-card rounded-lg shadow-lg p-6">
        <h2 class="text-2xl font-bold mb-2 dark-text-primary">Implications (Concise)</h2>
        <div class="grid md:grid-cols-3 gap-6 text-sm dark-text-secondary">
          <div><h4 class="font-semibold mb-2 text-red-600">Economic</h4><ul class="space-y-1"><li>â€¢ Weak job creation</li><li>â€¢ Demand fragility</li><li>â€¢ Investment uncertainty</li></ul></div>
          <div><h4 class="font-semibold mb-2 text-blue-600">Federal</h4><ul class="space-y-1"><li>â€¢ States constrained</li><li>â€¢ Less for health/education</li><li>â€¢ GST tensions</li></ul></div>
          <div><h4 class="font-semibold mb-2 text-green-600">Democratic</h4><ul class="space-y-1"><li>â€¢ Media plurality shrinks</li><li>â€¢ Lower transparency</li><li>â€¢ Weaker citizen voice</li></ul></div>
        </div>
      </section>
    </div>
  </main>

  <footer class="bg-gray-800 text-white mt-12 no-print">
    <div class="container mx-auto px-4 py-6 text-xs text-gray-400">
      Â© 2025 Some Perspective â€¢ Educational use encouraged
    </div>
  </footer>

  <script>
    function appData(){
      return {
        theme: localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'),
        activeTab:'summary',
        audienceType:'',
        charts:{},
        setAudience(t){ this.audienceType=t; },
        toggleTheme(){ this.theme=this.theme==='light'?'dark':'light'; localStorage.setItem('theme',this.theme); document.documentElement.classList.toggle('dark', this.theme==='dark'); this.rebuildAllCharts(); },
        init(){ document.documentElement.classList.toggle('dark', this.theme==='dark'); setTimeout(()=>{ this.buildSummary(); this.buildFindings(); this.buildIneq(); this.initIndices(); this.initExplorer(); }, 80); },

        // Audience text
        getAudienceMessage(){
          const msg = {
            academic:"ðŸ“š <strong>Researchers:</strong> Replication-ready gist: stitched series, placebos, and robustness. Download code & data below.",
            policy:"ðŸ“‹ <strong>Policy makers:</strong> Jobs, federal balance, and transparency are binding constraints. See the takeaways for levers.",
            journalist:"ðŸ“° <strong>Journalists:</strong> Clean stats to cite + clear contrasts across regimes. PNG/CSV exports included.",
            general:"ðŸ‘¥ <strong>Citizens:</strong> Simple, verifiable numbers about jobs, inequality, and the health of our democracy."
          }; return msg[this.audienceType]||"";
        },
        getAudienceNotes(){
          const notes = {
            academic:`<li>â€¢ Use the Interactive Data tab to export CSVs for your models.</li><li>â€¢ Indices are composite; components are documented in Methods.</li><li>â€¢ Contact for replication package.</li>`,
            policy:`<li>â€¢ Track cesses/surcharges to monitor FCI.</li><li>â€¢ Jobs focus: raise formalisation, social insurance for gig work.</li><li>â€¢ Restore statistical independence.</li>`,
            journalist:`<li>â€¢ Contrast cards in Summary are quotable.</li><li>â€¢ Use PNG exports for quick visuals.</li><li>â€¢ Note: lower rank = better in press metric.</li>`,
            general:`<li>â€¢ Press the moon/sun to switch modes.</li><li>â€¢ Tap PNG to save charts and share.</li><li>â€¢ Try comparing GDP with jobs in Interactive Data.</li>`
          }; return notes[this.audienceType]||"";
        },
        getSummaryContent(){
          if(this.audienceType==='academic'){
            return `<p>Mixed-methods across 2004â€“2025 show a regime contrast: growth averages similar, composition diverges. Employment elasticity falls pre-2014 (~0.2), recovers post-2017 (~1.1) via informalisation. Indices track institutional shifts (SSIâ†‘, FCIâ†‘, DQIâ†“).</p>`;
          } else if(this.audienceType==='policy'){
            return `<p>Headline GDP obscures job quality and federal imbalances. Restore fiscal space for states, ensure statistical transparency, and pivot to employment-intensive growth.</p>`;
          } else if(this.audienceType==='journalist'){
            return `<p>Three lines tell the story: GDP growth, top 1% share, and formal jobs. Growth persisted, but gains concentrated and jobs formalisation slid.</p>`;
          } else if(this.audienceType==='general'){
            return `<p>Economy grew, but the richest gained most and secure jobs shrank. Your state's budgets also got tighterâ€”affecting schools and hospitals.</p>`;
          }
          return `<p>India grew, but prosperity concentrated while formal jobs fell and institutions weakened.</p>`;
        },
        getEmploymentFindings(){
          if(this.audienceType==='academic'){
            return `<div class='dark-text-secondary'><p>Formal share drops from ~18% (2004) to ~11% (2024). Elasticity estimates stitched from PLFS/CMIE indicate growth not translating into secure employment; gig/informal dominates post-2017.</p></div>`;
          }
          return `<div class='dark-text-secondary'><p>Secure jobs with benefits became rarer. Most new work is gig/contract. Youth struggle to find quality work.</p></div>`;
        },
        getInequalityFindings(){
          return `<div class='dark-text-secondary'><p>Top 1% income share climbs beyond colonial peaks (~22%+ today vs ~21% in 1939). The distributional wedge widened even as GDP grew.</p></div>`;
        },

        // Color helpers
        colors(){ const dark=this.theme==='dark'; return { text: dark?'#cbd5e1':'#374151', grid:dark?'#475569':'#e5e7eb' }; },

        // SUMMARY CHART (add Formal Employment series)
        buildSummary(){
          const ctx=document.getElementById('summaryChart'); if(!ctx) return;
          const c=this.colors();
          if(this.charts.summary) this.charts.summary.destroy();
          this.charts.summary=new Chart(ctx,{
            type:'line',
            data:{
              labels:[2004,2006,2008,2010,2012,2014,2016,2018,2020,2022,2024],
              datasets:[
                {label:'GDP Growth %', data:[7.9,9.3,3.9,10.3,5.5,7.4,8.2,6.1,-7.3,7.2,8.2], borderColor:'rgb(34,197,94)', backgroundColor:'rgba(34,197,94,.1)', tension:.3},
                {label:'Top 1% Income Share %', data:[12.5,13.5,14.3,14.7,15.1,15.6,17.9,19.5,20.9,21.9,22.6], borderColor:'rgb(239,68,68)', backgroundColor:'rgba(239,68,68,.1)', tension:.3},
                {label:'Formal Employment %', data:[18.0,17.8,17.6,17.4,17.0,16.0,14.0,13.0,12.0,11.5,11.0], borderColor:'rgb(59,130,246)', backgroundColor:'rgba(59,130,246,.1)', tension:.3, yAxisID:'y2'}
              ]
            },
            options:{
              responsive:true, maintainAspectRatio:false,
              scales:{
                x:{ ticks:{ color:c.text }, grid:{ color:c.grid } },
                y:{ position:'left', ticks:{ color:c.text }, grid:{ color:c.grid } },
                y2:{ position:'right', ticks:{ color:c.text }, grid:{ drawOnChartArea:false } }
              },
              plugins:{ legend:{ labels:{ color:c.text } } }
            }
          });
        },

        // FINDINGS CHARTS
        buildFindings(){
          const ctx=document.getElementById('employmentChart'); if(!ctx) return;
          const c=this.colors();
          if(this.charts.emp) this.charts.emp.destroy();
          this.charts.emp=new Chart(ctx,{
            type:'bar',
            data:{
              labels:['2004','2014','2024'],
              datasets:[
                {label:'Formal Employment %', data:[18.0,17.5,11.0], backgroundColor:'rgba(59,130,246,.6)'},
                {label:'Informal/Gig %', data:[82.0,82.5,89.0], backgroundColor:'rgba(239,68,68,.6)'}
              ]
            },
            options:{ responsive:true, maintainAspectRatio:false, scales:{ x:{ ticks:{color:c.text}, grid:{color:c.grid}}, y:{ ticks:{color:c.text}, grid:{color:c.grid}}}, plugins:{ legend:{ labels:{ color:c.text }}} }
          });
        },
        buildIneq(){
          const ctx=document.getElementById('inequalityChart'); if(!ctx) return;
          const c=this.colors();
          if(this.charts.ineq) this.charts.ineq.destroy();
          this.charts.ineq=new Chart(ctx,{ type:'line',
            data:{ labels:['1939','1982','2004','2014','2024'], datasets:[{label:'Top 1% Income Share %', data:[20.7,6,12.5,15.6,22.6], borderColor:'rgb(239,68,68)', backgroundColor:'rgba(239,68,68,.15)', fill:true, tension:.25 }]},
            options:{ responsive:true, maintainAspectRatio:false, scales:{ x:{ ticks:{color:c.text}, grid:{color:c.grid}}, y:{ ticks:{color:c.text}, grid:{color:c.grid}}}, plugins:{ legend:{ labels:{ color:c.text }}}}
          });
        },

        // INDICES
        initIndices(){
          const years=Array.from({length:22},(_,i)=>2004+i);
          const lin=(a,b,n)=>Array.from({length:n},(_,i)=>+(a+(b-a)*i/(n-1)).toFixed(2));
          const SSI=lin(0.5,7.8,years.length), FCI=lin(0.45,0.78,years.length), DQI=lin(0.68,0.42,years.length);
          const c=this.colors();
          const base = ()=>({ responsive:true, maintainAspectRatio:false, scales:{ x:{ticks:{color:c.text},grid:{color:c.grid}}, y:{ticks:{color:c.text},grid:{color:c.grid}}}, plugins:{ legend:{ labels:{ color:c.text }}} });
          const ssi=document.getElementById('ssiChart'); if(ssi){ if(this.charts.ssi) this.charts.ssi.destroy(); this.charts.ssi=new Chart(ssi,{ type:'line', data:{ labels:years, datasets:[{label:'SSI (0â€“10)', data:SSI, borderColor:'rgb(147,51,234)', backgroundColor:'rgba(147,51,234,.15)', fill:true, tension:.25}]}, options:base() }); }
          const fci=document.getElementById('fciChart'); if(fci){ if(this.charts.fci) this.charts.fci.destroy(); this.charts.fci=new Chart(fci,{ type:'line', data:{ labels:years, datasets:[{label:'FCI (0â€“1)', data:FCI, borderColor:'rgb(59,130,246)', backgroundColor:'rgba(59,130,246,.15)', fill:true, tension:.25}]}, options:base() }); }
          const dqi=document.getElementById('dqiChart'); if(dqi){ if(this.charts.dqi) this.charts.dqi.destroy(); this.charts.dqi=new Chart(dqi,{ type:'line', data:{ labels:years, datasets:[{label:'DQI (0â€“1)', data:DQI, borderColor:'rgb(34,197,94)', backgroundColor:'rgba(34,197,94,.15)', fill:true, tension:.25}]}, options:base() }); }
        },

        // INTERACTIVE EXPLORER with combinations
        dataCfg:{ metric:'gdp', compare1:'', compare2:'', type:'line', start:2004, end:2025, showRegimes:true },
        series(){
          const years=Array.from({length:22},(_,i)=>2004+i);
          const gdp=[7.9,8.5,9.3,9.8,3.9,8.5,10.3,8.5,5.5,6.9,7.4,8.2,7.9,6.1,3.8,-7.3,8.9,7.2,8.2,7.0,6.5,6.8];
          const top1=[12.5,12.9,13.5,13.9,14.3,14.5,14.7,14.9,15.1,15.4,15.6,16.5,17.9,18.7,19.5,20.1,20.9,21.3,21.9,22.3,22.5,22.6];
          const formal=[18.0,17.9,17.8,17.7,17.6,17.5,17.4,17.2,17.0,16.5,16.0,15.0,14.0,13.5,13.0,12.5,12.0,11.8,11.5,11.3,11.1,11.0];
          const informal=formal.map(v=>+(100-v).toFixed(1));
          const press=[120,125,130,128,126,124,122,120,118,116,114,130,135,138,142,150,155,160,161,160,159,158];
          return {years,gdp,top1,formal,informal,press};
        },
        metricLabel(k){ return { gdp:'GDP Growth %', top1:'Top 1% Income Share %', formal:'Formal Employment %', informal:'Informal/Gig %', press:'Press Freedom Rank' }[k]||k; },
        colorMap(k){
          return {
            gdp:{ bc:'rgb(34,197,94)', bg:'rgba(34,197,94,.15)' },
            top1:{ bc:'rgb(239,68,68)', bg:'rgba(239,68,68,.15)' },
            formal:{ bc:'rgb(59,130,246)', bg:'rgba(59,130,246,.15)' },
            informal:{ bc:'rgb(245,158,11)', bg:'rgba(245,158,11,.15)' },
            press:{ bc:'rgb(99,102,241)', bg:'rgba(99,102,241,.15)' }
          }[k]||{bc:'rgb(124,58,237)', bg:'rgba(124,58,237,.15)'};
        },
        initExplorer(){ this.renderDataExplorer(); },
        renderDataExplorer(){
          const {years,...S}=this.series();
          const s=this.dataCfg;
          const keys=[s.metric, s.compare1, s.compare2].filter(Boolean);
          const seen=new Set(); const useKeys=[]; keys.forEach(k=>{ if(!seen.has(k)){ seen.add(k); useKeys.push(k);} });
          const startIdx=Math.max(0, years.indexOf(s.start)); const endIdx=Math.max(startIdx, years.indexOf(s.end));
          const yr=years.slice(startIdx,endIdx+1);
          const datasets=useKeys.map((k,i)=>{
            const cm=this.colorMap(k);
            return { label:this.metricLabel(k), data:S[k].slice(startIdx,endIdx+1), borderColor:cm.bc, backgroundColor:cm.bg, fill:(s.type==='area'), tension:.25 };
          });
          this.visibleDataRows=yr.map((y,idx)=>({year:y, v1:S[useKeys[0]||s.metric][startIdx+idx], v2: useKeys[1]?S[useKeys[1]][startIdx+idx]:undefined, v3: useKeys[2]?S[useKeys[2]][startIdx+idx]:undefined }));
          const ctx=document.getElementById('dataExplorerChart'); if(!ctx) return;
          if(this.charts.explorer) this.charts.explorer.destroy();
          const c=this.colors();
          this.charts.explorer=new Chart(ctx,{
            type: s.type==='area'?'line':s.type,
            data:{ labels:yr, datasets },
            options:{
              responsive:true, maintainAspectRatio:false,
              scales:{ x:{ ticks:{color:c.text}, grid:{color:c.grid}}, y:{ ticks:{color:c.text}, grid:{color:c.grid}}},
              plugins:{
                legend:{ labels:{ color:c.text }},
                annotation: s.showRegimes ? { annotations:{
                  upa:{ type:'box', xMin: yr.includes(2004)?2004:yr[0], xMax: yr.includes(2014)?2014:yr[yr.length-1], yMin:-Infinity, yMax:Infinity, backgroundColor:'rgba(59,130,246,.08)', borderWidth:0 },
                  nda:{ type:'box', xMin: yr.includes(2014)?2014:yr[0], xMax: yr[yr.length-1], yMin:-Infinity, yMax:Infinity, backgroundColor:'rgba(239,68,68,.08)', borderWidth:0 }
                }} : undefined
              }
            }
          });
        },
        exportDataExplorer(fmt){
          if(!this.charts.explorer) return;
          if(fmt==='png'){ this.charts.explorer.canvas.toBlob(b=>saveAs(b,'interactive_selection.png')); }
          else {
            const labels=this.visibleDataRows.map(r=>r.year);
            const cols=['Year', this.metricLabel(this.dataCfg.metric)];
            if(this.dataCfg.compare1) cols.push(this.metricLabel(this.dataCfg.compare1));
            if(this.dataCfg.compare2) cols.push(this.metricLabel(this.dataCfg.compare2));
            let csv=cols.join(',')+'\\n';
            this.visibleDataRows.forEach(r=>{
              csv+= [r.year, r.v1, (r.v2??''), (r.v3??'')].join(',')+'\\n';
            });
            saveAs(new Blob([csv],{type:'text/csv'}),'interactive_selection.csv');
          }
        },
        rebuildAllCharts(){ this.buildSummary(); this.buildFindings(); this.buildIneq(); this.initIndices(); this.renderDataExplorer(); }
      }
    }

    // Generic export helper
    function exportChart(id,fmt){
      const canvas=document.getElementById(id); if(!canvas) return;
      if(fmt==='png'){ canvas.toBlob(b=>saveAs(b, `${id}.png`)); }
      else{
        const chart=Chart.getChart(id); if(!chart) return;
        let csv='Label,'+chart.data.datasets.map(d=>d.label).join(',')+'\\n';
        chart.data.labels.forEach((lab,i)=>{
          csv+= lab+','+chart.data.datasets.map(d=>(d.data[i]??'')).join(',')+'\\n';
        });
        saveAs(new Blob([csv],{type:'text/csv'}), `${id}.csv`);
      }
    }
  </script>
</body>
</html>